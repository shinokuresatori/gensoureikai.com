<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Viewer</title>
<link rel="stylesheet" href="https://booth.pm/items/1028555/font.css"> <!-- 仮のURL、実際はダウンロード後CSS参照 -->
<style>
body {
  background:#000;
  color:#e0e0e0;
  font-family: "装甲明朝", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  padding:30px;
}

h1,h2,h3 {
  letter-spacing:0.25em;
  font-weight:normal;
  position:relative;
}

h1::before, h2::before, h3::before {
  content:"┏━━━━━━━━━━━━━━━━━━━━━━┓";
  display:block;
  color:#555;
  margin-bottom:6px;
}
h1::after, h2::after, h3::after {
  content:"┗━━━━━━━━━━━━━━━━━━━━━━┛";
  display:block;
  color:#555;
  margin-top:6px;
}

.section {
  margin-bottom:30px;
}

#today, #realtime, #onsale, #investigation {
  border:1px solid #555;
  padding:20px;
  background:#050505;
  min-height:80px;
  white-space:pre-wrap;
}

.controls {
  display:flex;
  align-items:center;
  gap:20px;
  margin-bottom:10px;
  color:#888;
}

#monthLabel {
  letter-spacing:0.2em;
}

.calendar {
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:2px;
  border:1px solid #333;
  padding:4px;
  background:#020202;
}

.weekday {
  text-align:center;
  font-size:0.85em;
  color:#666;
  border-bottom:1px solid #222;
  padding-bottom:4px;
}

.day {
  border:1px solid #222;
  padding:10px;
  min-height:60px;
  cursor:pointer;
  background:#010101;
  position:relative;
  transition: all 0.2s;
}

.day.has::after {
  content:"■";
  position:absolute;
  bottom:4px;
  right:6px;
  font-size:10px;
  color:#888;
}

.day.future {
  color:#444;
}

.day.today {
  outline:1px solid #fff;
}

.day.selected {
  outline:2px solid #6fa8ff;
}

.empty {
  border:none;
  cursor:default;
}

#detail {
  margin-top:20px;
  border:1px solid #444;
  padding:15px;
  min-height:80px;
  white-space:pre-wrap;
  background:#050505;
}

button {
  background:#000;
  color:#ccc;
  border:1px solid #444;
  padding:4px 10px;
  cursor:pointer;
}
button:hover {
  background:#111;
}

/* ====== 未来日点滅アニメ ====== */
@keyframes blinkMask {
  0%, 50%, 100% { color: #444; transform: translateX(0); }
  25% { color: #888; transform: translateX(1px); }
  75% { color: #bbb; transform: translateX(-1px); }
}
#detail.future {
  animation: blinkMask 1s infinite;
}

/* 進行度バー */
.progress-container {
  background:#222;
  border:1px solid #555;
  border-radius:4px;
  overflow:hidden;
  height:20px;
  margin-top:10px;
}
.progress-bar {
  background:#6fa8ff;
  height:100%;
  width:0%;
  transition: width 0.5s;
}
</style>
</head>
<body>

<h1>調査中のARG</h1>
<div id="investigation">読み込み中…</div>

<h1>本日の記録</h1>
<div id="today">読み込み中…</div>

<h1>今開催中のリアルタイムARG</h1>
<div id="realtime">読み込み中…</div>

<h1>販売中のARG</h1>
<div id="onsale">読み込み中…</div>

<h1>記録カレンダー</h1>
<div class="controls">
  <button onclick="changeMonth(-1)">◀</button>
  <div id="monthLabel"></div>
  <button onclick="changeMonth(1)">▶</button>
</div>

<div class="calendar" id="calendar"></div>
<div id="detail"></div>

<h2>進行度</h2>
<div class="progress-container">
  <div class="progress-bar" id="progressBar"></div>
</div>

<script>
let DATA = {};
let selectedDiv = null;

// ダミーデータ（実際はAPIから取得）
let ARG_DATA = {
  investigation: "ARG-α 調査中…\nヒントを解析中",
  realtime: "ARG-β 現在進行中！\nプレイヤー参加可能",
  onsale: "ARG-γ 販売中！\n購入して参加可能",
  progress: 45 // %
};

function updateARG() {
  document.getElementById("investigation").textContent = ARG_DATA.investigation;
  document.getElementById("realtime").textContent = ARG_DATA.realtime;
  document.getElementById("onsale").textContent = ARG_DATA.onsale;
  document.getElementById("progressBar").style.width = ARG_DATA.progress + "%";
}

// 今日の日付取得
function getTodayJST() {
  const d = new Date();
  d.setHours(d.getHours() + 9);
  return d.toISOString().slice(0,10);
}

// 表示中の年月
let viewYear, viewMonth;

// 未来日伏せ字
function mask(text) {
  return "▓".repeat(Math.max(10, text.length));
}

// データ取得
async function loadData() {
  try {
    const res = await fetch("/api/data");
    DATA = await res.json();
    render();
    updateARG();
  } catch(e) {
    console.error(e);
    document.getElementById("today").textContent = "データ取得エラー";
  }
}

// 月移動
function changeMonth(diff) {
  viewMonth += diff;
  if (viewMonth < 0) { viewMonth = 11; viewYear--; }
  if (viewMonth > 11) { viewMonth = 0; viewYear++; }
  render();
}

// カレンダー描画
function render() {
  const todayKey = getTodayJST();

  document.getElementById("today").textContent =
    DATA[todayKey] || "本日の記録は存在しません";

  document.getElementById("monthLabel").textContent =
    `${viewYear}年 ${viewMonth + 1}月`;

  const cal = document.getElementById("calendar");
  cal.innerHTML = "";

  const weekdays = ["日","月","火","水","木","金","土"];
  weekdays.forEach(w => {
    const div = document.createElement("div");
    div.className = "weekday";
    div.textContent = w;
    cal.appendChild(div);
  });

  const firstDay = new Date(viewYear, viewMonth, 1).getDay();

  for (let i = 0; i < firstDay; i++) {
    const empty = document.createElement("div");
    empty.className = "empty";
    cal.appendChild(empty);
  }

  const last = new Date(viewYear, viewMonth + 1, 0).getDate();

  for (let d = 1; d <= last; d++) {
    const key = `${viewYear}-${String(viewMonth+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const div = document.createElement("div");
    div.className = "day";
    div.textContent = d;

    const isFuture = key > todayKey;
    const hasData = DATA[key];

    if (hasData) div.classList.add("has");
    if (isFuture) div.classList.add("future");
    if (key === todayKey) div.classList.add("today");

    div.onclick = () => {
      if (selectedDiv) selectedDiv.classList.remove("selected");
      div.classList.add("selected");
      selectedDiv = div;

      const detailDiv = document.getElementById("detail");
      if (hasData) {
        detailDiv.textContent = `【${key}】\n\n` + (isFuture ? mask(DATA[key]) : DATA[key]);
        if (isFuture) detailDiv.classList.add("future");
        else detailDiv.classList.remove("future");
      } else {
        detailDiv.textContent = `【${key}】\n\n記録なし`;
        detailDiv.classList.remove("future");
      }
    };

    cal.appendChild(div);
  }
}

// 初期化
(function init() {
  const now = new Date();
  viewYear = now.getFullYear();
  viewMonth = now.getMonth();
  loadData();
  setInterval(loadData, 5000);
})();
</script>

</body>
</html>
